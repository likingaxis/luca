---
{"dg-publish":true,"permalink":"/anno-2/sistemi-operativi/codici-in-c/esercizi/11-thread-1-0-100/"}
---

>[!tip] consegna
>
>Scrivere un programma con tre thread che risolvono il seguente problema:
> 
> - Un buffer di `n` elementi inizializzato a `-1` viene riempito nel seguente modo:
>     - Il primo thread aggiunge nelle posizioni pari del buffer un numero casuale da `0` a `100`.
>     - Il secondo thread aggiunge nelle posizioni dispari del buffer un numero casuale da `100` a `200`.
>     - Il terzo thread modifica il buffer nel seguente modo:
>         - `buff[0] = buff[0]`
>         - `buff[1] = buff[1] + buff[0]`
>         - `buff[2] = buff[1] + buff[2]`
> - Utilizzare la mutua esclusione.

```c
#include<stdio.h>

#include<stdlib.h>

#include<unistd.h>

#include<pthread.h>

#include<fcntl.h>

#include<time.h>

#define n 10

int buf[n]={-1};

pthread_mutex_t mutex;

void* thread1()

{

    srand(time(NULL));

    int num=0;

    pthread_mutex_lock(&mutex);

    for(int i=0;i<n;i=i+2)

    {

        num=rand()%101;

        printf("sono t1 sto stampando %d in posizione %d \n",num,i);

        buf[i]=num;

    }

    pthread_mutex_unlock(&mutex);

    pthread_exit(NULL);

}

void *thread2()

{

    srand(time(NULL));

    pthread_mutex_lock(&mutex);

    int num=0;

    for(int i=1;i<n;i=i+2)

    {

        num=100+rand()%101;

        printf("sono t2 sto stampando %d in posizione %d \n",num,i);

        buf[i]=num;

    }

    pthread_mutex_unlock(&mutex);

    pthread_exit(NULL);

}

void *thread3()

{

    pthread_mutex_lock(&mutex);

    buf[0]=buf[0];

    buf[1]=buf[1]+buf[0];

    buf[2]=buf[1]+buf[2];

    pthread_mutex_unlock(&mutex);

    printf("ho scambiato i numeri");

    pthread_exit(NULL);

}

int main(int argc,char **argv)

{

    pthread_t t1,t2,t3;

    pthread_mutex_init(&mutex,NULL);

    pthread_create(&t1,NULL,thread1,NULL);

    pthread_create(&t2,NULL,thread2,NULL);

    pthread_create(&t3,NULL,thread3,NULL);

    pthread_join(t1,NULL);

    pthread_join(t2,NULL);

    pthread_join(t3,NULL);

    pthread_mutex_destroy(&mutex);

    return 0;

  

}
```