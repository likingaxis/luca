---
{"dg-publish":true,"permalink":"/anno-2/sistemi-operativi/codici-in-c/esercizi/1-processi-che-leggono-occorrenze-file/"}
---

>[!tip] consegna
> 1. Creare un programma che legge un file e conta le occorrenze di una parola nel seguente modo:
>     
>     - Il primo processo legge dall’inizio alla metà e conta le occorrenze della parola.
>     - Il secondo processo legge dalla metà fino alla fine e conta le occorrenze della parola.
>     - Inviano poi il numero di occorrenze al processo padre, il quale le somma e le stampa a video.

```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <sys/types.h>
#include <fcntl.h>
#include <string.h>
#include <sys/wait.h>

int conta(char *stringa,char* buf,int start,int end)
{
    int lenp=strlen(stringa);
    int contatore=0;
    if(start!=0) end=(end-lenp+1);
    else end--;
    for(int i=start;i <=(end);i++)
    {
        int cntmp=0;
        while(cntmp<lenp)
        {
            if(stringa[cntmp]==buf[cntmp+i])
            {
                cntmp++;
            }
            else break;
        }
        if(cntmp==lenp)
        {
            contatore++;
        }

    }


    return contatore;
}

int main(int argc, char **argv)
{

    if(argc!=2) exit(1);
    char *stringa = argv[1];
    int rd;
    int fd=open("file.txt",O_RDONLY);
    if(fd==-1) exit(1);
    int pip[2];
    pipe(pip);
    char buf[4096];
    ssize_t len=read(fd,buf,4096);
    buf[len] = '\0';
    fflush(stdout);
    printf("lunghezza %d \n",len);
    pid_t p1;
    pid_t p2;
    p1=fork();
    if(p1==0)
    {

        close(pip[0]);
        int counter=0;
        counter=conta(stringa,buf,0,len/2);
        fflush(stdout);
        printf("primo processo %d %d \n",counter,len/2);
        write(pip[1],&counter,sizeof(int));
        exit(0);

    }
    if(p1>0)
    {
        p2=fork();
        if(p2==0){
            int counter=0;
            counter=conta(stringa,buf,len/2,len);
            fflush(stdout);
            printf("sono il secondo processo %d %d \n",counter,len);
            write(pip[1],&counter,sizeof(int));
            exit(0);
        }

    }


    if(p1>0 && p2>0)
    {
        int num1=0;
        int num2=0;
        close(pip[1]);
        read(pip[0],&num1,sizeof(int));
        read(pip[0],&num2,sizeof(int));
        fflush(stdout);
        printf("sono il padre e le parole sono %d \n",(num1+num2));
        waitpid(p1,NULL,0);
        waitpid(p2,NULL,0);
        exit(0);
    }

    return 0;
}

```
