---
{"dg-publish":true,"permalink":"/anno-2/sistemi-operativi/codici-in-c/esercizi/13-semafori-e-posizioni-pari/"}
---


>[!tip] consegna
>Due thread:
> 
> - Il produttore inserisce numeri pari da `0` a `100` in posizioni pari e numeri dispari da `100` a `200` in posizioni dispari in un buffer di `N` elementi inizializzato a `-1`.
> - Il consumatore legge dal buffer un numero pari e uno dispari, li somma e stampa la somma.


```c
#include<pthread.h>

#include<stdio.h>

#include<stdlib.h>

#include<unistd.h>

#include<semaphore.h>

#include<time.h>

#define N 10

int buf[N]={-1};

sem_t sem;

sem_t full;

sem_t empty;

int stop=0;

int s1=0,s2=0;

  

void up(sem_t *s)

{

    sem_post(s);

}

void down(sem_t *s)

{

    sem_wait(s);

}

void *producer()

{

    int p=0;

    int d=1;

    int num1=0;

    int num2=101;

  

    while(1)

    {

        if(s1==1 && s2==1)

        {

            break;

        }

  

        down(&empty);

        down(&sem);

        //inserisco numero pari

        if (num1>=100){printf("pari arrivati %d \n",num1); s1=1;}

        else{

        printf("ho scritto un numero pari nella pos %d %d \n",p,num1);

        buf[p]=num1;

        p = (p + 2) % N;

        num1+=2;

        }

        if (num2>=200){printf("dispari arrivati %d \n",num2); s2=1;}

        else{

        printf("ho scritto un numero dispari nella pos %d %d\n",d,num2);

        buf[d]=num2;

        num2+=2;

        d = (d + 2) % N;

        }

        up(&full);

        up(&sem);

    }

    pthread_exit(NULL);

}

void *consumer()

{

  

    int p=0;

    int d=1;

    int n=0;

    int n1=0;

    while(1)

    {

        if(s1==1 && s2==1)

        {

            break;

        }

        down(&full);

        down(&sem);

        n=buf[p];

        printf(" ecco il numero pari: %d \n",n);  

        p = (p + 2) % N;

        printf(" ecco il numero dispari: %d \n",n1);

        n1=buf[d];

        d = (d + 2) % N;

        up(&empty);

        up(&sem);

        printf("somma di %d+%d  è %d  nelle posizioni %d %d\n",n,n1,n+n1,p,d);

    }

    pthread_exit(NULL);

}

int main()

{

    pthread_t pro,cons;

    sem_init(&sem,0,1);

    sem_init(&full,0,0);

    sem_init(&empty,0,N);

    pthread_create(&pro,NULL,producer,NULL);

    pthread_create(&cons,NULL,consumer,NULL);

    pthread_join(pro,NULL);

    pthread_join(cons,NULL);

    sem_destroy(&sem);

    sem_destroy(&empty);

    sem_destroy(&full);

    return 0;

}
```
