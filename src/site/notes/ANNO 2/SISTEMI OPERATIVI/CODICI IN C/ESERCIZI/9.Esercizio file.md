---
{"dg-publish":true,"permalink":"/anno-2/sistemi-operativi/codici-in-c/esercizi/9-esercizio-file/"}
---

>[!tip] consegna
> Implementare un programma che utilizzi `fork` e pipe per la comunicazione tra processi:
> 
> - Il programma crea un file di testo e poi due processi figli.
> - Un processo figlio scrive una sequenza di numeri interi pari nel file.
> - L’altro processo figlio scrive una sequenza di numeri interi dispari nello stesso file.
> - Il processo padre legge i dati dal file e li stampa a video.


```c
#include <stdio.h>

#include <unistd.h>

#include <fcntl.h>

#include <stdlib.h>

#include <time.h>

#include <sys/wait.h>

int main(int argc, char **argv)

{

    int n=9;

    int fd=open("mario.txt",O_CREAT | O_RDWR,0644);

    pid_t p1,p2;

    srand(time(NULL));

    close(fd);

    p1=fork();

    if(p1==-1) exit(1);

    if(p1==0)

    {

        fd=open("mario.txt",O_RDWR);

        int arr[n];

        int num=0;

        for(int i=0;i<n;i++)

        {

            num=rand()%100;

            if(num%2!=0) arr[i]=num+1;

            else arr[i]=num;

        }

        lseek(fd,0,SEEK_SET);

        write(fd,arr,n*sizeof(int));

        close(fd);

        exit(0);

    }

    if(p1>0)

    {

        fd=open("mario.txt",O_RDWR);

        p2=fork();

        if(p2==-1) exit(1);

        if(p2==0)

        {

            int num=0;

            int arr[n];

            for(int i=0;i<n;i++)

            {

                num=rand()%100;

                if (num%2==0) arr[i]=num+1;

                else arr[i]=num;

            }

            lseek(fd,sizeof(int)*n,SEEK_SET);

            write(fd,arr,sizeof(int)*n);

            close(fd);

        }

    }

    if(p1>0 && p2>0)

    {  

        fd=open("mario.txt",O_RDWR);

        if (waitpid(p1,NULL,0)==-1) exit(1);

        if (waitpid(p2,NULL,0)==-1) exit(1);

        int buf[4096];

        lseek(fd,0,SEEK_SET);

        ssize_t size=read(fd,buf,4096);

        for(int i=0;i<size/sizeof(int);i++)

        {

            fflush(stdout);

            printf("stampa : %d \n",buf[i]);

        }

        exit(0);

    }

    return 0;

}
```