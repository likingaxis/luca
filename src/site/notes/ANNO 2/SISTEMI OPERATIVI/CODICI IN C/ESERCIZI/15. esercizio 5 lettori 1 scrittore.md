---
{"dg-publish":true,"permalink":"/anno-2/sistemi-operativi/codici-in-c/esercizi/15-esercizio-5-lettori-1-scrittore/"}
---

>[!tip] consegna
>Sei thread: uno scrittore e cinque lettori.
> 
> - Lo scrittore scrive su un buffer numeri dispari da `0` a `50` nelle posizioni pari e numeri pari da `50` a `100` nelle posizioni dispari.
> - I lettori leggono coppie di numeri (pari, dispari), li sommano e stampano i risultati.
> 

```c
#include <stdio.h>

#include <unistd.h>

#include <stdlib.h>

#include <pthread.h>

#include <time.h>

#define N 10

int gestione=0;

pthread_mutex_t mutex;

void * scrittore(void * buffer)

{

    pthread_mutex_lock(&mutex);

    srand(time(NULL));

    int num=0;

    int *buffer1=(int *) buffer;

    for(int i=0;i<N;i++)

    {

        if (i%2==0)

        {

            num=rand()%51;

            if(num%2==0) buffer1[i]=num+1;

            else buffer1[i]=num;

        }

        else

        {

            num=50+rand()%51;

            if(num%2==0) buffer1[i]=num;

            else buffer1[i]=num+1;

        }

        printf("ho appena messo un numero \n");

    }

    printf("ho appena finito \n");

    pthread_mutex_unlock(&mutex);

    pthread_exit(NULL);

}

  

void * lettore(void * buffer)

{

    int * buffer1=(int *)buffer;

    while(gestione<N){

    pthread_mutex_lock(&mutex);

    if(gestione==N-1)

    {

        printf("numero da solo\n");

        pthread_mutex_unlock(&mutex);

        break;

        gestione=N;

    }

    printf("ecco il risultato della posizione %d %d dei numeri %d + %d = %d \n",gestione+1,gestione+2,buffer1[gestione],buffer1[gestione+1],buffer1[gestione]+buffer1[gestione+1]);

    gestione=gestione+2;

    pthread_mutex_unlock(&mutex);

    }

    pthread_exit(NULL);

}

int main(int argc, char** argv)

{

    int buffer[N];

    pthread_t scrittor,lettor;

    pthread_mutex_init(&mutex,NULL);

    pthread_create(&scrittor,NULL,scrittore,buffer);

    pthread_join(scrittor,NULL);

    for(int i=0;i<5;i++) pthread_create(&lettor,NULL,lettore,buffer);

    for(int i=0;i<5;i++) pthread_join(lettor,NULL);

    printf("codice terminato");

    pthread_mutex_destroy(&mutex);

    return 0;

}
```